---
title: "For_now"
author: "Lingyao"
date: "2017/9/27"
output:
  pdf_document: default
  html_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


```{r include=FALSE}
library(ggplot2)
library(dplyr)
library(gridExtra)
library(rgdal)
# install.packages("broom")
load("data_short.RData")
data <- tbl_df(data)
```

In this part, we are going to analyse attributes of the ad, including whether it is instant bookable and cancellation policy. 

Change factors to numeric
```{r}
instant_bookable_n <-as.numeric(data_short$instant_bookable)
cancellation_policy_n <-as.numeric(data_short$cancellation_policy)
number_of_reviews_n <- as.numeric(data_short$number_of_reviews)
```

It is very common that estimators are highly sensitive to outliers. To make our variables more comparable, we are going to cap floor the data for dependent variable price_pp, discarde extreme values and remain 95% of the data. 

```{r}
quantile(data_short$price_pp, prob = seq(0, 1, 0.05), 'na.rm' = TRUE)
```

# Analysis on cleaning_fee
If we cap floor the data and remain 95% of them, we can see that there exists a pattern that with higher cleaning fee, prices also becomes higher. From the plot, there is not very linear relation between them, while its p value suggests otherwise and its coefficient of determination is relatively high (considering that we have 95 variables in total). 

# instant_bookable
```{r}
summary(data_short$price_pp)
```


```{r}
ggplot(data_short, aes(x = instant_bookable, y = price_pp)) + geom_boxplot()
```



```{r}
instant_bookable_filt <- data_short %>% select(instant_bookable, price_pp)
instant_bookable_filt <- data_short %>% filter(price_pp <= 50)
ggplot(instant_bookable_filt, aes(x = instant_bookable, y = price_pp)) + geom_boxplot()
```



```{r}
lm(formula = price_pp ~ instant_bookable_n, data = data_short)
summary(lm(price_pp ~ instant_bookable_n, data = data_short))
```


# cancellation_policy

```{r}
summary(data_short$cancellation_policy)
ggplot(data_short, aes(x = cancellation_policy, y=price_pp)) + geom_boxplot()
```

```{r}
cancellation_policy_filt <- data_short %>% select(cancellation_policy, price_pp)
cancellation_policy_filt <- data_short %>% filter(price_pp <= 50)
ggplot(cancellation_policy_filt, aes(x = cancellation_policy, y = price_pp)) + geom_boxplot()
```

```{r}
lm(formula = price_pp ~ cancellation_policy, data = data_short)
summary(lm(price_pp ~ cancellation_policy, data = data_short))
```


# number_of_reviews

```{r}
quantile(number_of_reviews_n, prob = seq(0, 1, 0.05), 'na.rm' = TRUE)
```

```{r}
number_of_reviews_main <- pmin(number_of_reviews_n, 83)
summary(number_of_reviews_main)
```

```{r}
number_of_reviews_filt <- data_short %>% select(number_of_reviews_n, price_pp)
number_of_reviews_filt <- data_short %>% filter(price_pp <= 50)
ggplot(data_short, aes(y = data_short$number_of_reviews_main, x = number_of_reviews_filt$price_pp)) + geom_point() + geom_smooth()
```

```{r}
lm(formula = price_pp ~ reviews_main, data = data_short)
summary(lm(price_pp ~ reviews_main, data = data_short))
```
If we cap floor the data and remain 95% of them, we can see that there exists a pattern that with higher cleaning fee, prices also becomes higher. From the plot, there is not very linear relation between them, while its p value suggests otherwise and its coefficient of determination is relatively high (considering that we have 95 variables in total). 
Although we have ignored the tail, its R^2 remains relatively low. I suggeat that we can keep it as an alternative.
